<html>

<head>  <script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>
</head>

<body><p>Step 3 : Scan this qrcode with your Altme wallet and get your KYC card</p>
    <div id="qrcode"></div>
    <script>
        fetch("/kyc/get_qrcode/{{id}}").then((res)=> {

            //new QRCode(document.getElementById("qrcode"), res.url);
            //window.location.href = res.url;
            console.log(res.json().then(obj=> new QRCode(document.getElementById("qrcode"), obj.url)))
        
        })
        var source = new EventSource('/kyc/verifier_stream');
        source.onmessage = function (event) {
            const result = JSON.parse(event.data);
            console.log(result)

            
            if(result.type==="callback"){
                if (result.id === '{{id}}' ) {
                new QRCode(document.getElementById("qrcode"), result.url);
                //window.location.href = result.url;
            }
            /*else {
                window.location.href = "/error/";
            }*/
        }
        };
            

    </script>
</body>

</html>